<!DOCTYPE html>
<html lang="en">
<head>
  // ... existing meta tags ...

  <!-- Add Google Fonts -->
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600&display=swap" rel="stylesheet">
  
  <!-- Add loading spinner CSS -->
  <style>
    :root {
      --primary: #4CAF50;
      --primary-light: #81c784;
      --secondary: #ff9800;
      --secondary-light: #ffb74d;
      --background: #121212;
      --text-color: #e0e0e0;
      --card-bg: #1e1e1e;
      --border-color: #333;
      --error-color: #f44336;
      --success-color: #4caf50;
    }

    /* ... existing body and header styles ... */

    .container {
      max-width: 1000px;
      margin: 20px auto;
      padding: 20px;
      animation: fadeIn 0.5s ease-in;
    }

    .search-box {
      width: calc(100% - 24px);
      transition: all 0.3s ease;
      border: 2px solid var(--border-color);
    }

    .search-box:focus {
      border-color: var(--primary);
      outline: none;
      box-shadow: 0 0 5px var(--primary-light);
    }

    .question-card {
      transition: transform 0.2s ease, box-shadow 0.2s ease;
      border: 1px solid var(--border-color);
    }

    .question-card:hover {
      transform: translateY(-2px);
      box-shadow: 0px 4px 15px rgba(0, 0, 0, 0.4);
    }

    /* Loading Spinner */
    .loading {
      display: flex;
      justify-content: center;
      align-items: center;
      padding: 2rem;
    }

    .loading::after {
      content: "";
      width: 40px;
      height: 40px;
      border: 4px solid var(--border-color);
      border-top: 4px solid var(--primary);
      border-radius: 50%;
      animation: spin 1s linear infinite;
    }

    .error-message {
      color: var(--error-color);
      padding: 1rem;
      border: 1px solid var(--error-color);
      border-radius: 4px;
      margin: 1rem 0;
    }

    /* Animations */
    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(20px); }
      to { opacity: 1; transform: translateY(0); }
    }

    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }

    /* Responsive Design */
    @media (max-width: 768px) {
      .container { margin: 10px; padding: 15px; }
      h1 { font-size: 1.75rem; }
      .question-card { padding: 15px; }
    }
  </style>
</head>
<body>
  // ... existing header ...

  <script>
    // Debounce function for search
    function debounce(func, wait) {
      let timeout;
      return function executedFunction(...args) {
        const later = () => {
          clearTimeout(timeout);
          func(...args);
        };
        clearTimeout(timeout);
        timeout = setTimeout(later, wait);
      };
    }

    // Enhanced MathJax loading
    function waitForMathJax(callback) {
      if (window.MathJax && window.MathJax.startup) {
        window.MathJax.startup.promise.then(callback);
      } else {
        setTimeout(() => waitForMathJax(callback), 100);
      }
    }

    // Improved content loading and error handling
    async function fetchQuestions() {
      const contentContainer = document.getElementById('content-container');
      try {
        const response = await fetch('qa.md');
        if (!response.ok) {
          throw new Error(`Failed to load qa.md (${response.status})`);
        }

        let mdContent = await response.text();
        mdContent = mdContent
          .replace(/\$\$(.*?)\$\$/gs, '\\[ $1 \\]')
          .replace(/\$(.*?)\$/g, '\\( $1 \\)');

        contentContainer.innerHTML = `<div class="question-card">${marked.parse(mdContent)}</div>`;
        
        // Initialize search functionality
        initializeSearch(mdContent);
        
        waitForMathJax(() => {
          MathJax.typesetPromise().then(() => {
            // Add fade-in animation after content is loaded
            document.querySelector('.question-card').style.opacity = '1';
          });
        });
      } catch (error) {
        console.error("Error:", error);
        contentContainer.innerHTML = `
          <div class="error-message">
            <h3>Error Loading Content</h3>
            <p>${error.message}</p>
            <button onclick="fetchQuestions()" class="retry-button">Retry</button>
          </div>`;
      }
    }

    // Search functionality
    function initializeSearch(originalContent) {
      const searchBox = document.querySelector('.search-box');
      const contentContainer = document.getElementById('content-container');

      const handleSearch = debounce((searchTerm) => {
        if (!searchTerm) {
          contentContainer.innerHTML = `<div class="question-card">${marked.parse(originalContent)}</div>`;
          waitForMathJax(() => MathJax.typesetPromise());
          return;
        }

        const lines = originalContent.split('\n');
        const filteredContent = lines.filter(line => 
          line.toLowerCase().includes(searchTerm.toLowerCase())
        ).join('\n');

        contentContainer.innerHTML = `<div class="question-card">${marked.parse(filteredContent)}</div>`;
        waitForMathJax(() => MathJax.typesetPromise());
      }, 300);

      searchBox.addEventListener('input', (e) => handleSearch(e.target.value));
    }

    document.addEventListener("DOMContentLoaded", fetchQuestions);
  </script>
</body>
</html>